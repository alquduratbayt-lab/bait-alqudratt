# ๐ ุฏููู ูุธุงู ุฅุฏุงุฑุฉ ุงููุดุฑููู ูุงูุตูุงุญูุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงููุดุฑููู ูุน ุตูุงุญูุงุช ูุฑูุฉ ูุณูุญ ุจุฅูุดุงุก ุฃุฏูุงุฑ ูุฎุตุตุฉ ูุชุนููู ุตูุงุญูุงุช ูุญุฏุฏุฉ ููู ุฏูุฑ.

---

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงูููุดุฃุฉ:

1. **`permissions`** - ุฌุฏูู ุงูุตูุงุญูุงุช (21 ุตูุงุญูุฉ)
2. **`roles`** - ุฌุฏูู ุงูุฃุฏูุงุฑ (5 ุฃุฏูุงุฑ ุงูุชุฑุงุถูุฉ + ุฃุฏูุงุฑ ูุฎุตุตุฉ)
3. **`role_permissions`** - ุฌุฏูู ุฑุจุท ุงูุฃุฏูุงุฑ ุจุงูุตูุงุญูุงุช
4. **`admins`** - ุฌุฏูู ุงููุดุฑููู
5. **`activity_logs`** - ุฌุฏูู ุณุฌู ุงููุดุงุทุงุช

### ุงูุฃุฏูุงุฑ ุงูุงูุชุฑุงุถูุฉ:

1. **ูุฏูุฑ ุนุงู (Super Admin)** - ุตูุงุญูุงุช ูุงููุฉ
2. **ูุฏูุฑ ูุญุชูู (Content Manager)** - ุฅุฏุงุฑุฉ ุงููุญุชูู ุงูุชุนูููู
3. **ูุฏูุฑ ูุณุชุฎุฏููู (User Manager)** - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุฅุดุนุงุฑุงุช
4. **ูุฏูุฑ ูุงูู (Finance Manager)** - ุฅุฏุงุฑุฉ ุงููุฏููุนุงุช ูุงูุงุดุชุฑุงูุงุช
5. **ููุธู ุฏุนู (Support Agent)** - ุงูุฑุฏ ุนูู ุงูุชุฐุงูุฑ

### ุงูุตูุงุญูุงุช (21 ุตูุงุญูุฉ):

#### ุฅุฏุงุฑุฉ ุงููุธุงู:
- `manage_admins` - ุฅุฏุงุฑุฉ ุงููุดุฑููู
- `manage_roles` - ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ
- `view_activity_logs` - ุนุฑุถ ุณุฌู ุงููุดุงุทุงุช

#### ุฅุฏุงุฑุฉ ุงููุญุชูู:
- `manage_subjects` - ุฅุฏุงุฑุฉ ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ
- `manage_books` - ุฅุฏุงุฑุฉ ุงููุชุจ
- `manage_exams` - ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑุงุช
- `manage_banners` - ุฅุฏุงุฑุฉ ุงูุจุงูุฑุงุช
- `manage_onboarding` - ุฅุฏุงุฑุฉ ุดุงุดุงุช ุงูุชุฑุญูุจ
- `manage_calm_moments` - ุฅุฏุงุฑุฉ ูุญุธุงุช ุงููุฏูุก

#### ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู:
- `view_users` - ุนุฑุถ ุงููุณุชุฎุฏููู
- `manage_users` - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- `send_notifications` - ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช

#### ุฅุฏุงุฑุฉ ุงููุงููุฉ:
- `view_payments` - ุนุฑุถ ุงููุฏููุนุงุช
- `manage_payments` - ุฅุฏุงุฑุฉ ุงููุฏููุนุงุช
- `manage_subscriptions` - ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช
- `view_reports` - ุนุฑุถ ุงูุชูุงุฑูุฑ
- `manage_rewards` - ุฅุฏุงุฑุฉ ุงูุฌูุงุฆุฒ ูุงูููุงุท

#### ุงูุฏุนู ุงูููู:
- `view_tickets` - ุนุฑุถ ุงูุชุฐุงูุฑ
- `manage_tickets` - ุฅุฏุงุฑุฉ ุงูุชุฐุงูุฑ

#### ุงูุฅุนุฏุงุฏุงุช:
- `manage_app_settings` - ุฅุฏุงุฑุฉ ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู

---

## ๐ ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### 1. ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ:

```bash
cd admin-dashboard
npm install
```

ุงูููุชุจุงุช ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ:
- `bcryptjs` - ูุชุดููุฑ ูููุงุช ุงููุฑูุฑ
- `@types/bcryptjs` - TypeScript types

### 2. ุชุดุบูู Migration ูุงุนุฏุฉ ุงูุจูุงูุงุช:

ูู ุจุชุดุบูู ุงูููู:
```
supabase/migrations/20250131000006_create_admin_system.sql
```

ูู Supabase Dashboard ุฃู ุนุจุฑ CLI:
```bash
supabase db push
```

### 3. ุฅูุดุงุก ุฃูู ูุดุฑู (Super Admin):

ุงุณุชุฎุฏู Supabase SQL Editor ุฃู ุฃู ุฃุฏุงุฉ ูุชุดุบูู:

```sql
-- ุฅูุดุงุก ูุดุฑู ุชุฌุฑูุจู
INSERT INTO public.admins (email, password_hash, name, role_id, is_active)
VALUES (
  'admin@baitalqudratt.com',
  '$2a$10$YourHashedPasswordHere', -- ุงุณุชุฎุฏู bcrypt ูุชุดููุฑ ูููุฉ ุงููุฑูุฑ
  'ุงููุฏูุฑ ุงูุนุงู',
  (SELECT id FROM public.roles WHERE name = 'super_admin'),
  true
);
```

**ูุชุดููุฑ ูููุฉ ุงููุฑูุฑ:**
ููููู ุงุณุชุฎุฏุงู ุฃู ุฃุฏุงุฉ bcrypt online ุฃู Node.js:

```javascript
const bcrypt = require('bcryptjs');
const password = 'YourSecurePassword123';
const hash = bcrypt.hashSync(password, 10);
console.log(hash);
```

---

## ๐ฑ ุงูุตูุญุงุช ุงููุชุงุญุฉ

### 1. ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
**ุงููุณุงุฑ:** `/admin-login`

- ุชุณุฌูู ุฏุฎูู ุงููุดุฑููู ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ
- ุชุดููุฑ ูููุงุช ุงููุฑูุฑ ุจุงุณุชุฎุฏุงู bcrypt
- ุญูุธ ุงูุฌูุณุฉ ูู Cookies

### 2. ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุดุฑููู
**ุงููุณุงุฑ:** `/admins`
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ:** `manage_admins`

ุงูููุฒุงุช:
- ุนุฑุถ ูุงุฆูุฉ ุฌููุน ุงููุดุฑููู
- ุฅุถุงูุฉ ูุดุฑู ุฌุฏูุฏ
- ุชุนุฏูู ุจูุงูุงุช ุงููุดุฑู
- ุชูุนูู/ุชุนุทูู ุงููุดุฑู
- ุญุฐู ุงููุดุฑู
- ุชุนููู ุฏูุฑ ููู ูุดุฑู

### 3. ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
**ุงููุณุงุฑ:** `/roles`
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ:** `manage_roles`

ุงูููุฒุงุช:
- ุนุฑุถ ุฌููุน ุงูุฃุฏูุงุฑ
- ุฅูุดุงุก ุฏูุฑ ูุฎุตุต ุฌุฏูุฏ
- ุชุนุฏูู ุตูุงุญูุงุช ุฃู ุฏูุฑ
- ุญุฐู ุงูุฃุฏูุงุฑ ุงููุฎุตุตุฉ (ูุง ูููู ุญุฐู ุงูุฃุฏูุงุฑ ุงููุธุงููุฉ)
- ุงูุตูุงุญูุงุช ูุฌูุนุฉ ุญุณุจ ุงููุฆุงุช

### 4. ุตูุญุฉ ุณุฌู ุงููุดุงุทุงุช
**ุงููุณุงุฑ:** `/activity-logs`
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ:** `view_activity_logs`

ุงูููุฒุงุช:
- ุนุฑุถ ุฌููุน ุงูุนูููุงุช ุงููุณุฌูุฉ
- ููุชุฑุฉ ุญุณุจ ููุน ุงูุนูููุฉ
- ุนุฑุถ ุชูุงุตูู ูู ุนูููุฉ
- ูุนูููุงุช ุงููุดุฑู ุงูุฐู ูุงู ุจุงูุนูููุฉ
- IP Address
- ุงูุชุงุฑูุฎ ูุงูููุช

---

## ๐ ุงูุฃูุงู

### ุชุดููุฑ ูููุงุช ุงููุฑูุฑ:
- ุงุณุชุฎุฏุงู bcrypt ูุน salt rounds = 10
- ูุง ูุชู ุชุฎุฒูู ูููุงุช ุงููุฑูุฑ ุจุดูู ูุตู ุฃุจุฏุงู

### ุงูุฌูุณุงุช:
- ุญูุธ ุงูุฌูุณุฉ ูู HTTP-only Cookies
- ูุฏุฉ ุงูุฌูุณุฉ: 7 ุฃูุงู
- Secure flag ูู Production

### RLS (Row Level Security):
- ุชู ุชูุนูู RLS ุนูู ุฌููุน ุงูุฌุฏุงูู
- ุณูุงุณุงุช ูุฑุงุกุฉ ููุฌููุน
- ุณูุงุณุงุช ูุชุงุจุฉ ูููุตุงุฏููู ููุท

### ุชุณุฌูู ุงููุดุงุทุงุช:
- ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ ูุชู ุชุณุฌูููุง
- ุชุณุฌูู ุชููุงุฆู ูุชุณุฌูู ุงูุฏุฎูู
- ูููู ุฅุถุงูุฉ ุชุณุฌูู ูุฃู ุนูููุฉ ุจุงุณุชุฎุฏุงู `logActivity()`

---

## ๐ฏ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชุณุฌูู ุงูุฏุฎูู:
1. ุงุฐูุจ ุฅูู `/admin-login`
2. ุฃุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ
3. ุณูุชู ุชูุฌููู ุฅูู `/dashboard`

### 2. ุฅุถุงูุฉ ูุดุฑู ุฌุฏูุฏ:
1. ุงุฐูุจ ุฅูู `/admins`
2. ุงุถุบุท "ุฅุถุงูุฉ ูุดุฑู ุฌุฏูุฏ"
3. ุงููุฃ ุงูุจูุงูุงุช:
   - ุงูุงุณู
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ุฑูู ุงููุงุชู (ุงุฎุชูุงุฑู)
   - ุงูุฏูุฑ
   - ูููุฉ ุงููุฑูุฑ
4. ุงุถุบุท "ุฅุถุงูุฉ"

### 3. ุฅูุดุงุก ุฏูุฑ ูุฎุตุต:
1. ุงุฐูุจ ุฅูู `/roles`
2. ุงุถุบุท "ุฅูุดุงุก ุฏูุฑ ุฌุฏูุฏ"
3. ุฃุฏุฎู:
   - ุงุณู ุงูุฏูุฑ ุจุงูุฅูุฌููุฒูุฉ (ูุซู: `content_editor`)
   - ุงุณู ุงูุฏูุฑ ุจุงูุนุฑุจูุฉ (ูุซู: `ูุญุฑุฑ ูุญุชูู`)
   - ุงููุตู (ุงุฎุชูุงุฑู)
4. ุงุถุบุท "ุฅูุดุงุก"
5. ุงุฎุชุฑ ุงูุฏูุฑ ูู ุงููุงุฆูุฉ
6. ุญุฏุฏ ุงูุตูุงุญูุงุช ุงููุทููุจุฉ

### 4. ุชุนุฏูู ุตูุงุญูุงุช ุฏูุฑ:
1. ุงุฐูุจ ุฅูู `/roles`
2. ุงุฎุชุฑ ุงูุฏูุฑ ูู ุงููุงุฆูุฉ ุงููููู
3. ุญุฏุฏ/ุฃูุบู ุชุญุฏูุฏ ุงูุตูุงุญูุงุช
4. ูุชู ุงูุญูุธ ุชููุงุฆูุงู

---

## ๐ง API Endpoints

### ุงููุตุงุฏูุฉ:

#### POST `/api/admin/login`
ุชุณุฌูู ุฏุฎูู ุงููุดุฑู
```json
{
  "email": "admin@example.com",
  "password": "password123"
}
```

#### POST `/api/admin/logout`
ุชุณุฌูู ุฎุฑูุฌ ุงููุดุฑู

#### GET `/api/admin/session`
ุฌูุจ ุจูุงูุงุช ุงูุฌูุณุฉ ุงูุญุงููุฉ

### ุฅุฏุงุฑุฉ ุงููุดุฑููู:

#### POST `/api/admin/manage`
ุฅูุดุงุก ูุดุฑู ุฌุฏูุฏ
```json
{
  "email": "newadmin@example.com",
  "password": "password123",
  "name": "ุงุณู ุงููุดุฑู",
  "role_id": "uuid",
  "phone": "0501234567"
}
```

#### PUT `/api/admin/manage`
ุชุญุฏูุซ ูุดุฑู
```json
{
  "id": "uuid",
  "name": "ุงูุงุณู ุงูุฌุฏูุฏ",
  "role_id": "uuid",
  "is_active": true
}
```

#### DELETE `/api/admin/manage`
ุญุฐู ูุดุฑู
```json
{
  "id": "uuid"
}
```

---

## ๐ Functions ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### `get_admin_permissions(admin_id UUID)`
ุชูุฑุฌุน ุฌููุน ุตูุงุญูุงุช ุงููุดุฑู

```sql
SELECT * FROM get_admin_permissions('admin-uuid-here');
```

### `log_admin_activity(...)`
ุชุณุฌูู ูุดุงุท ุงููุดุฑู

```sql
SELECT log_admin_activity(
  'admin-uuid',
  'create',
  'subject',
  'resource-uuid',
  '{"name": "ูุงุฏุฉ ุฌุฏูุฏุฉ"}'::jsonb,
  '192.168.1.1'
);
```

---

## ๐จ ุงูุชุฎุตูุต

### ุฅุถุงูุฉ ุตูุงุญูุฉ ุฌุฏูุฏุฉ:

```sql
INSERT INTO public.permissions (name, display_name_ar, category, description)
VALUES (
  'custom_permission',
  'ุตูุงุญูุฉ ูุฎุตุตุฉ',
  'content',
  'ูุตู ุงูุตูุงุญูุฉ'
);
```

### ุฑุจุท ุตูุงุญูุฉ ุจุฏูุฑ:

```sql
INSERT INTO public.role_permissions (role_id, permission_id)
VALUES (
  (SELECT id FROM roles WHERE name = 'custom_role'),
  (SELECT id FROM permissions WHERE name = 'custom_permission')
);
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุง ุชุญุฐู ุงูุฃุฏูุงุฑ ุงููุธุงููุฉ** - ุงูุฃุฏูุงุฑ ุงูุชู `is_system_role = true` ูุง ูููู ุญุฐููุง
2. **ูููุงุช ุงููุฑูุฑ** - ูุฌุจ ุฃู ุชููู ูููุฉ (8 ุฃุญุฑู ุนูู ุงูุฃูู)
3. **Super Admin** - ูุฌุจ ุฃู ูููู ููุงู super admin ูุงุญุฏ ุนูู ุงูุฃูู ุฏุงุฆูุงู
4. **ุงูุตูุงุญูุงุช** - ุชุญูู ูู ุงูุตูุงุญูุงุช ูุจู ุนุฑุถ ุฃู ูุณู ูู ุงููุงุฌูุฉ
5. **Activity Logs** - ูุชู ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ ุชููุงุฆูุงู

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูููู ุชุณุฌูู ุงูุฏุฎูู
- ุชุฃูุฏ ูู ุฃู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุตุญูุญ
- ุชุฃูุฏ ูู ุฃู ุงููุดุฑู ูุดุท (`is_active = true`)
- ุชุฃูุฏ ูู ุชุดููุฑ ูููุฉ ุงููุฑูุฑ ุจุดูู ุตุญูุญ

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุงูุตูุงุญูุงุช
- ุชุฃูุฏ ูู ุฑุจุท ุงูุตูุงุญูุงุช ุจุงูุฏูุฑ ูู ุฌุฏูู `role_permissions`
- ุชุฃูุฏ ูู ุฃู ุงููุดุฑู ูุฏูู ุฏูุฑ ูุนูู

### ุงููุดููุฉ: ุฎุทุฃ ูู bcrypt
- ุชุฃูุฏ ูู ุชุซุจูุช ุงูููุชุจุฉ: `npm install bcryptjs @types/bcryptjs`
- ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู ุจุนุฏ ุงูุชุซุจูุช

---

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุงุณุชูุณุงุฑุงุชุ ุฑุงุฌุน:
- ุงูููุฏ ุงููุตุฏุฑู ูู `admin-dashboard/lib/adminAuth.ts`
- ููู Migration ูู `supabase/migrations/20250131000006_create_admin_system.sql`

---

**ุชู ุฅูุดุงุก ุงููุธุงู ุจูุฌุงุญ! ๐**

ููููู ุงูุขู ุงูุจุฏุก ุจุฅุถุงูุฉ ุงููุดุฑููู ูุชุนููู ุงูุตูุงุญูุงุช ุญุณุจ ุงุญุชูุงุฌุงุชู.
