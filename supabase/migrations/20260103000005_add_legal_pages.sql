-- إنشاء جدول الصفحات القانونية
CREATE TABLE IF NOT EXISTS legal_pages (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  page_type TEXT UNIQUE NOT NULL, -- 'terms', 'privacy', 'refund'
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- إدراج صفحات افتراضية
INSERT INTO legal_pages (page_type, title, content) VALUES
(
  'terms',
  'الشروط والأحكام',
  '# الشروط والأحكام

## 1. القبول بالشروط
باستخدامك لتطبيق بيت القدرات، فإنك توافق على الالتزام بهذه الشروط والأحكام.

## 2. استخدام التطبيق
- يجب أن يكون عمر المستخدم 13 عاماً أو أكثر
- يجب استخدام التطبيق للأغراض التعليمية فقط
- يُمنع استخدام التطبيق لأي أغراض غير قانونية

## 3. الحساب
- أنت مسؤول عن الحفاظ على سرية حسابك
- يجب إبلاغنا فوراً عن أي استخدام غير مصرح به

## 4. المحتوى
- جميع المحتويات محمية بحقوق الملكية الفكرية
- يُمنع نسخ أو توزيع المحتوى بدون إذن

## 5. الاشتراكات
- الاشتراكات تجدد تلقائياً ما لم يتم إلغاؤها
- يمكن إلغاء الاشتراك في أي وقت

## 6. التعديلات
نحتفظ بالحق في تعديل هذه الشروط في أي وقت.

## 7. الاتصال
للاستفسارات: support@baitalqudrat.com'
),
(
  'privacy',
  'سياسة الخصوصية',
  '# سياسة الخصوصية

## 1. المعلومات التي نجمعها
نقوم بجمع المعلومات التالية:
- الاسم والبريد الإلكتروني
- معلومات الجهاز
- بيانات الاستخدام والتقدم الدراسي

## 2. كيفية استخدام المعلومات
نستخدم معلوماتك لـ:
- تقديم وتحسين خدماتنا
- التواصل معك
- تخصيص تجربتك التعليمية

## 3. مشاركة المعلومات
- لا نبيع معلوماتك الشخصية لأطراف ثالثة
- قد نشارك المعلومات مع مقدمي الخدمات الموثوقين

## 4. أمن البيانات
نتخذ إجراءات أمنية لحماية معلوماتك.

## 5. حقوقك
لديك الحق في:
- الوصول إلى معلوماتك
- تصحيح معلوماتك
- حذف حسابك

## 6. ملفات تعريف الارتباط
نستخدم ملفات تعريف الارتباط لتحسين تجربتك.

## 7. التغييرات على السياسة
سنخطرك بأي تغييرات جوهرية على هذه السياسة.

## 8. الاتصال
للاستفسارات: privacy@baitalqudrat.com'
),
(
  'refund',
  'سياسة الاسترجاع والاستبدال',
  '# سياسة الاسترجاع والاستبدال

## 1. فترة الاسترجاع
- يمكنك طلب استرجاع خلال 14 يوماً من تاريخ الشراء
- يجب أن يكون الطلب مبرراً

## 2. شروط الاسترجاع
- لم يتم استخدام أكثر من 20% من المحتوى
- الطلب خلال الفترة المحددة

## 3. كيفية طلب الاسترجاع
1. تواصل معنا عبر البريد الإلكتروني
2. قدم رقم الطلب وسبب الاسترجاع
3. سيتم مراجعة طلبك خلال 3-5 أيام عمل

## 4. المبالغ المستردة
- سيتم إرجاع المبلغ بنفس طريقة الدفع
- قد يستغرق الأمر 7-14 يوم عمل

## 5. الاستثناءات
لا يمكن استرجاع:
- الاشتراكات المستخدمة بالكامل
- العروض الخاصة والتخفيضات

## 6. الاتصال
للاستفسارات: refund@baitalqudrat.com'
)
ON CONFLICT (page_type) DO NOTHING;

-- تفعيل RLS
ALTER TABLE legal_pages ENABLE ROW LEVEL SECURITY;

-- السماح بالقراءة للجميع
CREATE POLICY "Allow public read access on legal_pages" 
ON legal_pages FOR SELECT 
USING (true);

-- السماح بالتعديل للجميع (سيتم تقييده بـ service role)
CREATE POLICY "Allow admin full access on legal_pages" 
ON legal_pages FOR ALL 
USING (true)
WITH CHECK (true);
