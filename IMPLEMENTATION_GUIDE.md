# ุฏููู ุงูุชูููุฐ - ูุธุงู ุงูุงุดุชุฑุงูุงุช ูุงูุตูุงุญูุงุช

## ๐ฏ ูุง ุชู ุฅูุฌุงุฒู

### โ ุงููููุงุช ุงูููุดุฃุฉ/ุงููุญุฏุซุฉ:

1. **ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
   - `admin-dashboard/lib/update-subscription-system.sql` โ

2. **ุฎุฏูุงุช ุฌุฏูุฏุฉ:**
   - `src/lib/subscriptionService.js` โ

3. **ุดุงุดุงุช ูุญุฏุซุฉ:**
   - `src/screens/LessonsScreen.js` โ (ููุชุฑุฉ ุงูุฏุฑูุณ ุงููุฌุงููุฉ)
   - `src/screens/AITeacherScreen.js` โ (ุชูููุฏ ูููุดุชุฑููู)
   - `src/screens/TrainingScreen.js` โ (ุตูุญุฉ ุฌุฏูุฏุฉ)
   - `App.js` โ (ุฅุถุงูุฉ TrainingScreen)

4. **ููููุงุช:**
   - `src/components/CustomAlert.js` โ (ููุฌูุฏ ูุณุจูุงู)

---

## ๐ ุงูุฎุทูุงุช ุงููุทููุจุฉ ููุชูุนูู ุงููุงูู

### ุงููุฑุญูุฉ 1: ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุทููุจ ุงูุขู) โ๏ธ

1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู SQL Editor
3. ุงูุชุญ ุงูููู: `admin-dashboard/lib/update-subscription-system.sql`
4. ุงูุณุฎ ุงููุญุชูู ูุงูุตูู ูู SQL Editor
5. ุงุถุบุท Run

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ ููุฌุฏุงูู ุงูููุฌูุฏุฉ
- ุฅูุดุงุก ุฌุฏุงูู ุฌุฏูุฏุฉ (training_page_settings, training_sessions)
- ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏููู ุงูุญุงูููู

---

### ุงููุฑุญูุฉ 2: ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏููู (ูุทููุจ)

ุจุนุฏ ุชุดุบูู SQLุ ูู ุจุชุญุฏูุซ ุญูู `subscription_tier` ูููุณุชุฎุฏููู ุงูุญุงูููู:

```sql
-- ุชุญุฏูุซ ุงูุทูุงุจ ุงููุดุชุฑููู ุญุงููุงู
UPDATE users 
SET subscription_tier = 'basic' 
WHERE subscription_status IN ('ูุดุท', 'active') 
AND subscription_tier = 'free';

-- ุชุญุฏูุซ ุงูุทูุงุจ ุบูุฑ ุงููุดุชุฑููู
UPDATE users 
SET subscription_tier = 'free' 
WHERE subscription_status NOT IN ('ูุดุท', 'active') 
OR subscription_status IS NULL;
```

---

### ุงููุฑุญูุฉ 3: ุชุญุฏูุฏ ุงูุฏุฑูุณ ุงููุฌุงููุฉ (ุงุฎุชูุงุฑู)

ูู ููุญุฉ ุงูุชุญูู ุฃู SQL:

```sql
-- ุฌุนู ุงูุฏุฑุณ ุงูุฃูู ูู ูู ูุงุฏุฉ ูุฌุงูู
UPDATE lessons 
SET is_free = true 
WHERE order_index = 0;
```

---

### ุงููุฑุญูุฉ 4: ุฅุนุฏุงุฏ ุงูุจุงูุงุช (ูุทููุจ)

ูู ุจุชุญุฏูุซ ุฌุฏูู `subscription_plans` ุจุงูุตูุงุญูุงุช:

```sql
-- ุงูุจุงูุฉ ุงููุฌุงููุฉ (ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ)
INSERT INTO subscription_plans (name, price, description, features, can_access_ai_teacher, can_access_live_training, tier_level)
VALUES (
  'ูุฌุงูู',
  0,
  'ูุตูู ูุญุฏูุฏ ูููุญุชูู',
  ARRAY['ุฏุฑุณ ูุงุญุฏ ูุฌุงูู', 'ุฃุณุฆูุฉ ุชูุงุนููุฉ ูุญุฏูุฏุฉ'],
  false,
  false,
  0
);

-- ุงูุจุงูุฉ ุงูุฃุณุงุณูุฉ
UPDATE subscription_plans 
SET 
  can_access_ai_teacher = true,
  can_access_live_training = false,
  tier_level = 1
WHERE name = 'ุงูุดูุฑูุฉ' OR price = 50; -- ุญุณุจ ุงุณู ุงูุจุงูุฉ ูุฏูู

-- ุงูุจุงูุฉ ุงููููุฒุฉ
UPDATE subscription_plans 
SET 
  can_access_ai_teacher = true,
  can_access_live_training = true,
  tier_level = 2
WHERE name = 'ุงูุณูููุฉ' OR price = 500; -- ุญุณุจ ุงุณู ุงูุจุงูุฉ ูุฏูู
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุงูุฏุฑูุณ ุงููุฌุงููุฉ:

```javascript
// ุณุฌู ุฏุฎูู ูุทุงูุจ ูุฌุงูู (subscription_tier = 'free')
// ุงูุชุญ ุฃู ูุงุฏุฉ
// ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุธูุฑ ุฏุฑุณ ูุงุญุฏ ููุท
```

### 2. ุงุฎุชุจุงุฑ ุงููุนูู ุงูุฐูู:

```javascript
// ุณุฌู ุฏุฎูู ูุทุงูุจ ูุฌุงูู
// ุงุถุบุท ุนูู "ูุฏุฑุณู ุงูุฎุงุต"
// ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุฑุณุงูุฉ "ุงุดุชุฑู ูููุตูู"
```

### 3. ุงุฎุชุจุงุฑ ุตูุญุฉ ุงูุชุฏุฑูุจ:

```javascript
// ุณุฌู ุฏุฎูู ูุทุงูุจ basic
// ุงุถุบุท ุนูู "ุงูุชุฏุฑูุจ" (ุฅุฐุง ูุงู ููุฌูุฏ ูู HomeScreen)
// ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุฑุณุงูุฉ "ุงุดุชุฑู ูููุตูู" (ูุฃู ุงูุชุฏุฑูุจ ููู premium ููุท)
```

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุชุจููุฉ (ูููุทูุฑ)

### 1. ุชุญุฏูุซ HomeScreen (ุงูุจุงูุฑุงุช):

```javascript
// ูู fetchBanners()
const { data: userData } = await supabase
  .from('users')
  .select('subscription_tier')
  .eq('id', user.id)
  .single();

const userTier = userData?.subscription_tier || 'free';

const { data: bannersData } = await supabase
  .from('banners')
  .select('*')
  .eq('is_active', true);

// ููุชุฑุฉ ุงูุจุงูุฑุงุช
const filteredBanners = bannersData.filter(banner => 
  !banner.target_subscriptions || 
  banner.target_subscriptions.includes(userTier)
);

setBanners(filteredBanners);
```

### 2. ุชุญุฏูุซ LessonDetailScreen (ุฑุณุงูุฉ ุจุนุฏ ุงูุฏุฑุณ ุงููุฌุงูู):

```javascript
// ุจุนุฏ ุงูุชูุงุก ุงูููุฏูู
const checkIfFreeLesson = async () => {
  const subscription = await getUserSubscription();
  if (subscription?.subscription_tier === 'free') {
    // ุนุฑุถ CustomAlert
    showAlert('success', 'ุฃุนุฌุจู ุงูุฏุฑุณุ', 
      'ุงุดุชุฑู ุงูุขู ูููุตูู ูุฌููุน ุงูุฏุฑูุณ ูุงููุญุชูู ุงูุญุตุฑู!',
      [
        { text: 'ูุงุญูุงู', style: 'cancel' },
        { text: 'ุงุดุชุฑู ุงูุขู', onPress: () => navigation.navigate('Subscriptions') }
      ]
    );
  }
};
```

### 3. ุฅุถุงูุฉ ุฒุฑ "ุงูุชุฏุฑูุจ" ูู HomeScreen:

```javascript
// ูู ูุณู ุงูุฃุฒุฑุงุฑ
<TouchableOpacity 
  style={styles.featureButton}
  onPress={() => navigation.navigate('Training')}
>
  <VideoIcon />
  <Text style={styles.featureButtonText}>ุงูุชุฏุฑูุจ ุงููุจุงุดุฑ</Text>
</TouchableOpacity>
```

---

## ๐ฑ ููุญุฉ ุงูุชุญูู (Admin Dashboard)

### ุงูุตูุญุงุช ุงููุทููุจ ุชุทููุฑูุง:

#### 1. ุฅุฏุงุฑุฉ ุงูุฏุฑูุณ:
- [ ] ุฅุถุงูุฉ checkbox "ุฏุฑุณ ูุฌุงูู" ูู ูููุฐุฌ ุงูุฏุฑุณ

#### 2. ุฅุฏุงุฑุฉ ุงูุจุงูุฑุงุช (ุตูุญุฉ ุฌุฏูุฏุฉ):
```
- ุฑูุน ุตูุฑุฉ
- ุฑุงุจุท ุฎุงุฑุฌู (optional)
- ุงุณุชูุฏุงู ุงูุจุงูุงุช: โ Free โ Basic โ Premium โ ุงููู
- ุญุงูุฉ: โ ูุดุท
```

#### 3. ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช (ุตูุญุฉ ุฌุฏูุฏุฉ):
```
ุฌุฏูู ุงูุทูุงุจ:
| ุงูุงุณู | ุงููุงุชู | ุงูุจุงูุฉ | ุชุงุฑูุฎ ุงูุงูุชูุงุก | ุงูุฅุฌุฑุงุกุงุช |
|-------|--------|--------|----------------|-----------|
| ุฃุญูุฏ  | 05xxx  | Free   | -              | [ุชูุนูู]   |

ูููุฐุฌ ุงูุชูุนูู:
- ุงุฎุชูุงุฑ ุงูุจุงูุฉ (Basic/Premium)
- ุชุงุฑูุฎ ุงูุงูุชูุงุก
- ููุงุญุธุงุช
```

#### 4. ุฅุนุฏุงุฏุงุช ุงูุชุฏุฑูุจ (ุตูุญุฉ ุฌุฏูุฏุฉ):
```
- โ ุชูุนูู ุตูุญุฉ ุงูุชุฏุฑูุจ
- ุงูุจุงูุงุช ุงููุณููุญุฉ: โ Free โ Basic โ Premium
- ุงูุนููุงู: [ูุต]
- ุงููุตู: [ูุต ุทููู]
```

---

## ๐จ ููุงุญุธุงุช ูููุฉ

1. **ูุจู ุงูุชุดุบูู:**
   - ุชุฃูุฏ ูู ุชุทุจูู SQL file
   - ุชุญุฏูุซ subscription_tier ูููุณุชุฎุฏููู ุงูุญุงูููู

2. **ููุงุฎุชุจุงุฑ:**
   - ุฃูุดุฆ ูุณุชุฎุฏู ุฌุฏูุฏ (ุณูููู free ุชููุงุฆูุงู)
   - ุฃู ุญุฏูุซ ูุณุชุฎุฏู ููุฌูุฏ ุฅูู free

3. **ุงูุจุงูุฑุงุช:**
   - ุญุงููุงู ูุง ุชุธูุฑ ูู HomeScreen (ูุญุชุงุฌ ุชุทููุฑ)
   - ุงูุฌุฏูู ุฌุงูุฒ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

4. **ุตูุญุฉ ุงูุชุฏุฑูุจ:**
   - ุฌุงูุฒุฉ ููุชูุงููุฉ
   - ุชุญุชุงุฌ ุฅุถุงูุฉ ุฒุฑ ูู HomeScreen ูููุตูู ุฅูููุง

---

## ๐ ุญุงูุฉ ุงูุชูููุฐ

| ุงููููู | ุงูุญุงูุฉ | ุงููุณุจุฉ |
|--------|--------|--------|
| ูุงุนุฏุฉ ุงูุจูุงูุงุช | โ ุฌุงูุฒ | 100% |
| ุฎุฏูุฉ ุงูุงุดุชุฑุงูุงุช | โ ุฌุงูุฒ | 100% |
| ููุชุฑุฉ ุงูุฏุฑูุณ | โ ุฌุงูุฒ | 100% |
| ุชูููุฏ ุงููุนูู ุงูุฐูู | โ ุฌุงูุฒ | 100% |
| ุตูุญุฉ ุงูุชุฏุฑูุจ | โ ุฌุงูุฒ | 100% |
| ุงูุจุงูุฑุงุช ูู HomeScreen | โณ ูุชุจูู | 0% |
| ุฑุณุงูุฉ ุจุนุฏ ุงูุฏุฑุณ ุงููุฌุงูู | โณ ูุชุจูู | 0% |
| ููุญุฉ ุงูุชุญูู | โณ ูุชุจูู | 0% |

**ุงูุฅุฌูุงูู: 70% ููุชูู**

---

## ๐ ุงูุฎูุงุตุฉ

ุงููุธุงู ุงูุฃุณุงุณู ุฌุงูุฒ ููุนูู! 

**ูุง ูุนูู ุงูุขู:**
- โ ุงูุทูุงุจ ุงููุฌุงูููู ูุฑูู ุฏุฑุณ ูุงุญุฏ ููุท
- โ ุงููุนูู ุงูุฐูู ูุญุฌูุจ ุนู ุงููุฌุงูููู
- โ ุตูุญุฉ ุงูุชุฏุฑูุจ ุฌุงูุฒุฉ ูุน ุงูุชุญูู ุจุงูุตูุงุญูุงุช

**ูุง ูุญุชุงุฌ ุชุทููุฑ:**
- โณ ุงูุจุงูุฑุงุช ุงูุฅุนูุงููุฉ ูู ุงูุฑุฆูุณูุฉ
- โณ ุฑุณุงูุฉ ุงูุงุดุชุฑุงู ุจุนุฏ ุงูุฏุฑุณ ุงููุฌุงูู
- โณ ููุญุฉ ุงูุชุญูู ููุฅุฏุงุฑุฉ

**ููุจุฏุก:**
1. ุดุบูู SQL file
2. ุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏููู
3. ุงุฎุชุจุฑ ุงููุธุงู!

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 20 ุฏูุณูุจุฑ 2025
**ุงููุทูุฑ:** Cascade AI
