# ๐ฆ ุฏููู ูุธุงู ุจูู ุงูุฃุณุฆูุฉ (Question Bank System)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุจูู ุงูุฃุณุฆูุฉ ูุณูุญ ูููุฏุฑุงุก ุจุฅูุดุงุก ููุงุฐุฌ ุจุฏููุฉ ูุชุนุฏุฏุฉ ููู ุณุคุงูุ ุจุญูุซ ูุฑู ุงูุทุงูุจ ุฃุณุฆูุฉ ูุฎุชููุฉ ูู ูู ูุฑุฉ ูุดุงูุฏ ูููุง ุงูููุฏูู.

### ๐ฏ ุงููุฏู
- ููุน ุงูุทูุงุจ ูู ุญูุธ ุงูุฅุฌุงุจุงุช
- ุชุดุฌูุน ุงูููู ุงูุญูููู ุจุฏูุงู ูู ุงูุญูุธ
- ุฒูุงุฏุฉ ูุนุงููุฉ ุงูุชุนูู ูู ุฎูุงู ุงูุชูููุน

---

## ๐๏ธ ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `question_variants`
ูุฎุฒู ุงูููุงุฐุฌ ุงูุจุฏููุฉ ููุฃุณุฆูุฉ.

```sql
CREATE TABLE question_variants (
  id UUID PRIMARY KEY,
  parent_question_id UUID REFERENCES questions(id),
  variant_text TEXT NOT NULL,
  option_a TEXT NOT NULL,
  option_b TEXT NOT NULL,
  option_c TEXT NOT NULL,
  option_d TEXT NOT NULL,
  correct_answer VARCHAR(1) CHECK (correct_answer IN ('A', 'B', 'C', 'D')),
  question_image_url TEXT,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

### ุฌุฏูู `student_question_history`
ูุชุชุจุน ุงูุฃุณุฆูุฉ ุงูุชู ุดุงูุฏูุง ูู ุทุงูุจ.

```sql
CREATE TABLE student_question_history (
  id UUID PRIMARY KEY,
  student_id UUID REFERENCES auth.users(id),
  lesson_id UUID REFERENCES lessons(id),
  question_id UUID REFERENCES questions(id),
  variant_id UUID REFERENCES question_variants(id),
  answered_correctly BOOLEAN,
  viewed_at TIMESTAMP
);
```

---

## ๐ป ููููุฉ ุงูุงุณุชุฎุฏุงู (Admin Dashboard)

### 1๏ธโฃ ุฅุถุงูุฉ ุณุคุงู ุฃุณุงุณู
1. ุงูุชูู ุฅูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุฏุฑูุณ
2. ุฃุถู ุณุคุงูุงู ุนุงุฏูุงู ูุงููุนุชุงุฏ
3. ุงุญูุธ ุงูุฏุฑุณ ุฃููุงู

### 2๏ธโฃ ุฅุถุงูุฉ ููุงุฐุฌ ุจุฏููุฉ
1. ุงุถุบุท ุนูู ุฒุฑ **"ุจูู ุงูุฃุณุฆูุฉ ๐ฆ"** ุจุฌุงูุจ ุงูุณุคุงู
2. ุณููุชุญ modal ูุนุฑุถ:
   - ุงูุณุคุงู ุงูุฃุณุงุณู (ุจุฎูููุฉ ุฒุฑูุงุก)
   - ูุงุฆูุฉ ุงูููุงุฐุฌ ุงูุจุฏููุฉ
3. ุงุถุบุท **"ุฅุถุงูุฉ ูููุฐุฌ ุจุฏูู"**
4. ุงููุฃ ุงูุจูุงูุงุช:
   - ูุต ุงูุณุคุงู ุงูุจุฏูู
   - ุงูุฎูุงุฑุงุช ุงูุฃุฑุจุนุฉ (A, B, C, D)
   - ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ
5. ูุฑุฑ ุงูุนูููุฉ ูุฅุถุงูุฉ ููุงุฐุฌ ูุชุนุฏุฏุฉ (ูููุตุญ ุจู 3-5 ููุงุฐุฌ)
6. ุงุถุบุท **"ุญูุธ ูู ุงูุจูู"**

### 3๏ธโฃ ุชุนุฏูู ุฃู ุญุฐู ููุงุฐุฌ
- ูุชุนุฏูู ูููุฐุฌ: ุนุฏูู ุงูุญููู ูุจุงุดุฑุฉ
- ูุญุฐู ูููุฐุฌ: ุงุถุบุท ุฒุฑ "ุญุฐู" ุจุฌุงูุจ ุงููููุฐุฌ
- ุงุญูุธ ุงูุชุบููุฑุงุช ุจุงูุถุบุท ุนูู "ุญูุธ ูู ุงูุจูู"

---

## ๐ฑ ููููุฉ ุงูุนูู (Mobile App)

### ููุทู ุงุฎุชูุงุฑ ุงูุฃุณุฆูุฉ

```javascript
// ุนูุฏ ุนุฑุถ ุณุคุงู ููุทุงูุจ
async function getQuestionForStudent(studentId, questionId) {
  // 1. ุฌูุจ ุณุฌู ุงูุฃุณุฆูุฉ ุงููุนุฑูุถุฉ ููุทุงูุจ
  const history = await getStudentQuestionHistory(studentId, questionId);
  
  // 2. ุฌูุจ ุฌููุน ุงูููุงุฐุฌ ุงููุดุทุฉ
  const variants = await getActiveVariants(questionId);
  
  // 3. ุชุตููุฉ ุงูููุงุฐุฌ ุงูุชู ูู ูุดุงูุฏูุง ุงูุทุงูุจ
  const unseenVariants = variants.filter(v => 
    !history.some(h => h.variant_id === v.id)
  );
  
  // 4. ุงุฎุชูุงุฑ ูููุฐุฌ ุนุดูุงุฆู
  if (unseenVariants.length > 0) {
    return randomChoice(unseenVariants);
  } else if (variants.length > 0) {
    // ุฅุฐุง ุดุงูุฏ ูู ุงูููุงุฐุฌุ ุงุฎุชุฑ ุนุดูุงุฆูุงู ูู ุงููู
    return randomChoice(variants);
  } else {
    // ุฅุฐุง ูู ุชูุฌุฏ ููุงุฐุฌุ ุงุนุฑุถ ุงูุณุคุงู ุงูุฃุณุงุณู
    return getOriginalQuestion(questionId);
  }
}
```

### ุชุณุฌูู ุงูุณุฌู

```javascript
// ุจุนุฏ ุนุฑุถ ุงูุณุคุงู ููุทุงูุจ
async function recordQuestionView(studentId, lessonId, questionId, variantId, answeredCorrectly) {
  await supabase
    .from('student_question_history')
    .insert({
      student_id: studentId,
      lesson_id: lessonId,
      question_id: questionId,
      variant_id: variantId,
      answered_correctly: answeredCorrectly,
      viewed_at: new Date()
    });
}
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุฒุฑ ุจูู ุงูุฃุณุฆูุฉ
```tsx
<button 
  onClick={() => openQuestionBank(index)} 
  className="px-3 py-1 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg"
>
  <svg>...</svg>
  ุจูู ุงูุฃุณุฆูุฉ
</button>
```

### Modal ุจูู ุงูุฃุณุฆูุฉ
- **ุงูุนููุงู**: ุจูู ุงูุฃุณุฆูุฉ - ุงูุณุคุงู {ุฑูู}
- **ุงูุณุคุงู ุงูุฃุณุงุณู**: ูุนุฑูุถ ุจุฎูููุฉ ุฒุฑูุงุก/ุจููุณุฌูุฉ
- **ุงูููุงุฐุฌ ุงูุจุฏููุฉ**: ูุนุฑูุถุฉ ุจุฎูููุฉ ุจุฑุชูุงููุฉ
- **ุงูุฃุฒุฑุงุฑ**:
  - ุฅุถุงูุฉ ูููุฐุฌ ุจุฏูู (ุฃุฎุถุฑ)
  - ุญุฐู ูููุฐุฌ (ุฃุญูุฑ)
  - ุญูุธ ูู ุงูุจูู (ุจุฑุชูุงูู)
  - ุฅูุบุงุก (ุฑูุงุฏู)

---

## ๐ ุณูุงุณุงุช ุงูุฃูุงู (RLS)

### ูููุฏุฑุงุก
```sql
-- ุงููุฏุฑุงุก ูููููู ุฅุฏุงุฑุฉ ูู ุงูููุงุฐุฌ
CREATE POLICY "Admins can manage question variants"
  ON question_variants
  FOR ALL
  USING (true)
  WITH CHECK (true);
```

### ููุทูุงุจ
```sql
-- ุงูุทูุงุจ ูููููู ูุฑุงุกุฉ ุงูููุงุฐุฌ ุงููุดุทุฉ ููุท
CREATE POLICY "Students can view active variants"
  ON question_variants
  FOR SELECT
  USING (is_active = true);

-- ุงูุทูุงุจ ูููููู ูุฑุงุกุฉ ุณุฌููู ุงูุฎุงุต ููุท
CREATE POLICY "Students can view their own history"
  ON student_question_history
  FOR SELECT
  USING (auth.uid() = student_id);
```

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุณุคุงู ุฑูุงุถูุงุช

**ุงูุณุคุงู ุงูุฃุณุงุณู:**
```
ูุง ูู ูุงุชุฌ: 2 + 2 = ุ
A) 3
B) 4 โ
C) 5
D) 6
```

**ุงููููุฐุฌ ุงูุจุฏูู 1:**
```
ูุง ูู ูุงุชุฌ: 3 + 1 = ุ
A) 3
B) 4 โ
C) 5
D) 6
```

**ุงููููุฐุฌ ุงูุจุฏูู 2:**
```
ูุง ูู ูุงุชุฌ: 5 - 1 = ุ
A) 3
B) 4 โ
C) 5
D) 6
```

### ูุซุงู 2: ุณุคุงู ุนููู

**ุงูุณุคุงู ุงูุฃุณุงุณู:**
```
ูุง ูู ุนุฏุฏ ููุงูุจ ุงููุฌููุนุฉ ุงูุดูุณูุฉุ
A) 7
B) 8 โ
C) 9
D) 10
```

**ุงููููุฐุฌ ุงูุจุฏูู 1:**
```
ูู ุนุฏุฏ ุงูููุงูุจ ุงูุชู ุชุฏูุฑ ุญูู ุงูุดูุณุ
A) 7
B) 8 โ
C) 9
D) 10
```

---

## ๐ ูุตุงุฆุญ ููุงุณุชุฎุฏุงู ุงูุฃูุซู

### โ ุฃูุถู ุงูููุงุฑุณุงุช
1. **ุนุฏุฏ ุงูููุงุฐุฌ**: ุฃุถู 3-5 ููุงุฐุฌ ููู ุณุคุงู
2. **ุงูุชูููุน**: ุงุฌุนู ุงูููุงุฐุฌ ูุฎุชููุฉ ูู ุงูุตูุงุบุฉ ููู ูุชุณุงููุฉ ูู ุงูุตุนูุจุฉ
3. **ุงูุฌูุฏุฉ**: ุชุฃูุฏ ูู ุตุญุฉ ุฌููุน ุงูููุงุฐุฌ
4. **ุงูุชูููุช**: ุงูููุงุฐุฌ ุชุธูุฑ ูู ููุณ ุชูููุช ุงูุณุคุงู ุงูุฃุณุงุณู

### โ๏ธ ุชุฌูุจ
1. ุนุฏู ุฅุถุงูุฉ ููุงุฐุฌ ุณููุฉ ุฌุฏุงู ุฃู ุตุนุจุฉ ุฌุฏุงู
2. ุนุฏู ุชูุฑุงุฑ ููุณ ุงูุตูุงุบุฉ
3. ุนุฏู ุชุฑู ุญููู ูุงุฑุบุฉ

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: "ูุฌุจ ุญูุธ ุงูุฏุฑุณ ุฃููุงู"
**ุงูุญู**: ุงุญูุธ ุงูุฏุฑุณ ูุจู ุฅุถุงูุฉ ุงูููุงุฐุฌ ููุจูู

### ุงููุดููุฉ: ุงูููุงุฐุฌ ูุง ุชุธูุฑ ูู ุงูุชุทุจูู
**ุงูุญู**: 
1. ุชุฃูุฏ ูู ุฃู `is_active = true`
2. ุชุญูู ูู ุณูุงุณุงุช RLS
3. ุฑุงุฌุน ุณุฌู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุทุงูุจ ูุฑู ููุณ ุงูุณุคุงู ุฏุงุฆูุงู
**ุงูุญู**:
1. ุชุฃูุฏ ูู ูุฌูุฏ ููุงุฐุฌ ุจุฏููุฉ
2. ุชุญูู ูู ููุทู ุงูุงุฎุชูุงุฑ ุงูุนุดูุงุฆู
3. ุฑุงุฌุน ุฌุฏูู `student_question_history`

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงูุชูุงุฑูุฑ

### ุงุณุชุนูุงูุงุช ูููุฏุฉ

**ุนุฏุฏ ุงูููุงุฐุฌ ููู ุณุคุงู:**
```sql
SELECT 
  q.question_text,
  COUNT(qv.id) as variants_count
FROM questions q
LEFT JOIN question_variants qv ON q.id = qv.parent_question_id
GROUP BY q.id, q.question_text
ORDER BY variants_count DESC;
```

**ุงูุฃุณุฆูุฉ ุงูุฃูุซุฑ ูุดุงูุฏุฉ:**
```sql
SELECT 
  q.question_text,
  COUNT(sqh.id) as view_count
FROM questions q
LEFT JOIN student_question_history sqh ON q.id = sqh.question_id
GROUP BY q.id, q.question_text
ORDER BY view_count DESC
LIMIT 10;
```

**ูุนุฏู ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ:**
```sql
SELECT 
  q.question_text,
  COUNT(CASE WHEN sqh.answered_correctly = true THEN 1 END) * 100.0 / COUNT(*) as success_rate
FROM questions q
JOIN student_question_history sqh ON q.id = sqh.question_id
GROUP BY q.id, q.question_text
ORDER BY success_rate DESC;
```

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

### ุงูููุฒุงุช ุงููุฎุทุทุฉ
- [ ] ุชูููุฏ ููุงุฐุฌ ุชููุงุฆูุงู ุจุงุณุชุฎุฏุงู AI
- [ ] ุชุตููู ุงูููุงุฐุฌ ุญุณุจ ุงูุตุนูุจุฉ
- [ ] ุฅุญุตุงุฆูุงุช ุชูุตูููุฉ ููู ูููุฐุฌ
- [ ] ุชุตุฏูุฑ/ุงุณุชูุฑุงุฏ ุงูููุงุฐุฌ
- [ ] ูุธุงู ุชูููู ุงูููุงุฐุฌ ูู ุงูุทูุงุจ

---

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงูู:
- ุฑุงุฌุน ูุฐุง ุงูุฏููู ุฃููุงู
- ุชุญูู ูู ุณุฌูุงุช ุงูุฃุฎุทุงุก
- ุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ

---

**ุขุฎุฑ ุชุญุฏูุซ:** 31 ุฏูุณูุจุฑ 2025
**ุงูุฅุตุฏุงุฑ:** 1.0.0
